# 基本架构

## 1. 如何学习Redis

**Redis全景图包括"两大维度，三大主线"**

* **两大维度**：系统维度和应用维度
* **三大主线**：高性能、高可靠和高扩展
    * **高性能主线**：包括线程模型、数据结构、持久化、网络框架；
    * **高可靠主线**：包括主从复制、哨兵机制、集群；
    * **高扩展主线**：包括数据分片、负载均衡

**学习方式**

* **应用场景驱动(面)**
* **典型案例驱动(点)**

| <img src="https://mynotes-1252832980.cos.ap-shanghai.myqcloud.com/20220521170911.png" style="zoom:50%;" /> | <img src="https://mynotes-1252832980.cos.ap-shanghai.myqcloud.com/20220521170955.png" style="zoom:40%;" /> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

## 2. 一个键值数据库包括什么？

> 通常包括：**访问框架、索引模块、操作模块和存储模块**

### 2.1 可以存哪些数据

对于键值类型的数据库，基本的数据结构就是key-value模型，key是String类型，value可以是其他复杂类型。例如Memached支持的value类型仅仅为String类型，而Redis支持的value类型包括了String、哈希表、列表、集合等。

### 2.2 可以对数据做什么操作

* PUT：写入或更新一个key-value对

* GET：根据一个key读取相应的value

* DELETE：根据一个key删除一个value对

### 2.3 数据保存在内存还是在外存？

* 内存：读写超快(百ns级别)，但是断电易失，会丢失所有数据
* 外存：避免数据丢失，但是受限于磁盘的慢速读写(ms级别)，严重影响数据库的整体性能

<img src="https://mynotes-1252832980.cos.ap-shanghai.myqcloud.com/20220521174209.png" style="zoom:40%;" />

### 2.4 采用什么访问方式

* 通过函数库调用的方式供外部应用使用如libsimplekv.so
* 通过网络框架以Socket通信的形式对外提供键值对操作

### 2.5 如何定位键值对的位置

要想快速判断指定键是否存在于数据库就要依赖于索引模块，**索引模块的作用是让键值数据库根据key找到相应value的存储位置，进而执行操作。**

**索引类型**

* 哈希表
* B+树
* 字典树

Memcached和Redis采用哈希表作为key-value索引，而RocksDB则采用跳表作为内存中的key-value的索引。

### 2.6 不同操作的具体逻辑是什么样的?

索引模块负责根据key找到相应的value的存储位置，然后根据不同的操作执行不同的逻辑：

* 对于GET/SCAN操作，根据key返回value即可
* 对于PUT一个新的键值对，则需要为改键值对分配内存空间
* 对于DELETE操作，需要删除键值对后并释放相应的内存空间，这个过程由分配器完成

### 2.7 如何实现重启后快速提供服务？

* 将键值数据通过调用本地文件系统的操作接口保存在磁盘上
* SimKV只是周期性地把内存中的键值数据保存在文件上，这样可以避免频繁写盘操作的性能影响，潜在风险就是可能会丢失数据

## 3. 总结

<img src="https://mynotes-1252832980.cos.ap-shanghai.myqcloud.com/20220521181026.png" style="zoom:40%;" />

**从SimpleKV到Redis演进过程**

* Redis主要通过网络框架进行访问，不在是动态库，使得Redis可以作为一个基础性的网络服务进行访问，扩大了Redis的应用范围
* Redis的value数据类型很丰富，因此也提供了更多的操作接口
* Redis的持久化模块能支持两种方式：日志(AOF)和快照(RDB)，这两种方式具有不同的优劣势，影响到Redis的访问性能和可靠性能
* SimKV是个简单的单机剑指数据库，但是Redis支持高可靠集群和高扩展集群
