# 压缩列表

> 压缩列表是列表键和哈希键的底层实现之一。当一个列表键只包含少量列表项，并且每个列表项要么就是小整数值，要么就是长度比较短的字符串，那么Redis就会使用压缩列表来做列表键的底层实现。

## 1. 压缩列表的构成

> 压缩列表是由一系列特殊编码的连续内存块组成的顺序型数据结构。一个压缩列表可以包含任意多个节点，每个节点可以保存在保存一个字节数组或者一个整数值。

| zlbytes | zltail | zllen | entry1 | entry2 | ...  | entryN | zlend |
| ------- | ------ | ----- | ------ | ------ | ---- | ------ | ----- |

* zlbyest：
    * uint_32_t
    * 记录整个压缩列表占用的内存字节数：在对压缩列表进行内存重分配，或者计算zlend的位置时使用
* zltail:
    * uint_32_t
    * 记录整个压缩列表表尾结点距离压缩列表的起始地址有多少字节：通过这个偏移量，程序无须遍历整个压缩列表就可以确定标为节点的地址
* zllen
    * uint16_t
    * 记录了压缩列表包含的节点数量： 当这个属性的值小于UINT16_MAX(65535)时，这个属性的值就是压缩列表包含节点的数量；这个值等于UINT16_MAX时，节点的真实数量需要遍历整个压缩列表才能计算得出
* entryX
    * 列表节点
    * 压缩列表包含的各个节点，节点的长度由节点所保存的内容决定
* zlend
    * uint8_t
    * 0xFF(255)，用于标记压缩列表的末端

## 2. 压缩列表节点的构成

每个压缩列表节点可以保存一个字节数组或者一个整数值，其中，字节数组可以是一下三种长度之一:

* <= 63(2^6 -1)字节的字节数组；
* <=16383(2^14 -1)字节的字节数组；
* <=4294967295(2^32 - 1)字节的字节数组；

而整数值则可以是一下六种长度之一：

未完待续
