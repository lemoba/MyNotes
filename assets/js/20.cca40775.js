(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{458:function(s,t,a){"use strict";a.r(t);var n=a(11),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"构建镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#构建镜像"}},[s._v("#")]),s._v(" 构建镜像")]),s._v(" "),a("h2",{attrs:{id:"_1-基本命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-基本命令"}},[s._v("#")]),s._v(" 1. 基本命令")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1 FROM \t\t\t\t# 选择基础镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2 RUN  \t\t\t\t# 运行命令")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3 COPY \t\t\t\t# 复制文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 4 ADD  \t\t\t\t# 复制文件，如果是压缩文件则自动解压")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 5 WORKDIR \t\t# 设置当前工作目录，类似于cd，但是如果目标目录不存在则会创建")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 6 ENV\t\t\t\t\t# 设置环境变量")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 7 ARG\t\t\t\t\t# 设置环境变量")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 8 CMD\t\t\t\t\t# 容器启动命令")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 9 ENTRYPOINT\t# 容器启动命令")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 10 EXPOSE\t\t\t# 对外定义暴露端口")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 11 VOLUME \t\t# 持久化数据")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h3",{attrs:{id:"_1-1-文件复制和目录操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-文件复制和目录操作"}},[s._v("#")]),s._v(" 1.1 文件复制和目录操作")]),s._v(" "),a("p",[a("strong",[s._v("复制普通文件")])]),s._v(" "),a("blockquote",[a("p",[s._v("COPY和ADD都可以把local的一个文件复制到镜像里，如果目标目录不存在，则会自动创建")])]),s._v(" "),a("p",[a("strong",[s._v("复制压缩文件")])]),s._v(" "),a("blockquote",[a("p",[s._v("如果复制的是一个gzip等压缩文件，ADD会帮助我们自动去解压缩文件")])]),s._v(" "),a("h3",{attrs:{id:"_1-2-构建参数和环境变量-arg-vs-env"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-构建参数和环境变量-arg-vs-env"}},[s._v("#")]),s._v(" 1.2 构建参数和环境变量(ARG vs ENV)")]),s._v(" "),a("ul",[a("li",[s._v("ARG仅仅在构建镜像的时候可以使用，一旦构建完成在容器中是不能使用的，可以在构建是通过--build-arg来动态指定")]),s._v(" "),a("li",[s._v("ENV可以在镜像构建完成后可以在容器中使用")])]),s._v(" "),a("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://mynotes-1252832980.cos.ap-shanghai.myqcloud.com/image-20220317113950638.png"}}),s._v(" "),a("h3",{attrs:{id:"_1-3-cmd容器启动命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-cmd容器启动命令"}},[s._v("#")]),s._v(" 1.3 CMD容器启动命令")]),s._v(" "),a("ul",[a("li",[s._v("shell格式\n"),a("ul",[a("li",[s._v('CMD echo "hello"')]),s._v(" "),a("li",[s._v('ENTRYPOINT echo "hello"')])])]),s._v(" "),a("li",[s._v("Exec格式\n"),a("ul",[a("li",[s._v('CMD["echo", "hello"]')]),s._v(" "),a("li",[s._v('ENTRYPOINT["echo", "hello"]')])])])]),s._v(" "),a("p",[s._v("CMD可以用来设置容器启动时默认会执行的命令")]),s._v(" "),a("ul",[a("li",[s._v("容器启动时默认执行的命令")]),s._v(" "),a("li",[s._v("如果docker container run启动容器时指定了其他命令，则CMD命令会被忽略")]),s._v(" "),a("li",[s._v("如果定义了多个CMD，只有最后一个会被执行")])]),s._v(" "),a("p",[a("strong",[s._v("ENTRYPONT和CMD区别")])]),s._v(" "),a("ul",[a("li",[s._v("CMD设置的命令，可以在docker container run时传入其他的命令，覆盖掉CMD的命令，但是ENTRYPOINT所设置的命令是一定会被执行的")]),s._v(" "),a("li",[s._v("ENTRYPOINT和CMD可以联合使用，ENTRYPOINT设置执行的命令，CMD传递参数")])]),s._v(" "),a("p",[a("strong",[s._v("实例构建falsk应用")])]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" python:3.9.5-slim")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" app.py /src/")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" pip install flask")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /src")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" FLASH=app.py")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 5000")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" ["),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"flask"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"run"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-h"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.0.0.0"')]),s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h2",{attrs:{id:"_2-合理使用缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-合理使用缓存"}},[s._v("#")]),s._v(" 2. 合理使用缓存")]),s._v(" "),a("ul",[a("li",[s._v("一旦发现文件有变动，docker从当前行向下都不会使用缓存")]),s._v(" "),a("li",[s._v("将经常需要变动的文件放入行末")])])])}),[],!1,null,null,null);t.default=e.exports}}]);